<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    {% load static %}
    <link rel="stylesheet" href="{% static "node_modules/bootstrap/dist/css/bootstrap.css" %}">

    <link rel="stylesheet" href="{% static "styles/header.css" %}">
    <link rel="stylesheet" href="{% static "styles/text.css" %}">

    <script src="{% static "utils.js" %}"></script>

    <title>{% block head_title %}LK Moments{% endblock %}</title>
</head>
<body>
    <a name="#top"></a>

    {% block body %}
        {% include "header.html" %}
        <div class="content">
            {% block content %}
            {% endblock %}
        </div>
        {% include "footer.html" %}
    {% endblock %}

{#    <script src="{% static "node_modules/popper.js/dist/umd/popper.js" %}"></script>#}
    <script src="{% static "node_modules/jquery/dist/jquery.js" %}"></script>
    <script src="{% static "node_modules/bootstrap/dist/js/bootstrap.bundle.js" %}"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script>
        const domContainer = document.querySelector('#popularUsers');
        const e = React.createElement;
        class PopularUsers extends React.Component {
            constructor(props) {
                super(props);
            }

            componentDidMount() {
                request('GET', '/rest-api/users/?format=json', {}, function (code, data) {
                    if (code === 200) {
                        let res = [];
                        data = JSON.parse(data);
                        for (let user of data) {
                            let userSpan = React.createElement('a', {
                                key: user.username,
                                href: '/@' + user.username,
                                class: 'user'
                            }, user.username);
                            //userSpan.classList.add('user');
                            //userSpan.innerHTML = user.username;
                            res.push(userSpan);
                        }
                        this.setState({ users: React.createElement('span', null, res) });
                    }
                }.bind(this));
            }

            render() {
                if (this.state && this.state.users) {
                    return this.state.users;
                } else {
                    return 'Loading users...';
                }
            }
        }
        ReactDOM.render(React.createElement(PopularUsers), domContainer);

        document.querySelectorAll('.likeButton')
            .forEach(domContainer => {
                class LikeButton extends React.Component {
                  constructor(props) {
                    super(props);
                    this.state = { liked: false };
                  }

                  render() {
                    if (this.state.liked) {
                        return 'You liked this (' + this.props.commentId + ')';
                    }

                    return e(
                        'button',
                        { onClick: () => this.setState({ liked: true }) },
                        'Like'
                    );
                  }
                }
                const commentId = parseInt(domContainer.dataset.commentid, 10);
                ReactDOM.render(e(LikeButton, { commentId: commentId }), domContainer);
            });
    </script>
</body>
</html>
